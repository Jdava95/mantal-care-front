import React from "react";
import { useHistory } from "react-router-dom";
import { GoogleAuthProvider, signInWithPopup } from "firebase/auth";

import { Button } from "@core/styles/button";
import { Input } from "@core/styles/Input";
import { auth, createNewUser } from "@src/controller";

import { getUserData } from "@main/api/userApi";
import { RECORD_PAGE_PATH } from "@main/routing/mainConstants";
import {
    ActionColumn,
    BottomText,
    RegistrationTitle,
} from "@registr/styles/registrationStyles";

const RegistrationForm = () => {
    const history = useHistory();

    const login = async () => {
        const provider = new GoogleAuthProvider();
        const { user } = await signInWithPopup(auth, provider);
        if (user?.email) {
            const userData = await getUserData(user?.email);
            const isNotActive = Object.entries(userData).length === 0;

            isNotActive && (await createNewUser(user));

            history.push(RECORD_PAGE_PATH);
        } else {
            alert("Missing email");
        }
    };
    return (
        <>
            <div>
                <RegistrationTitle>Welcome! üëãüèª</RegistrationTitle>
                <ActionColumn>
                    <Input placeholder="Email" />
                    <Button onClick={() => void login()}>–í—Ö–æ–¥</Button>
                </ActionColumn>
            </div>

            <div>
                <BottomText>
                    –ü—Ä–æ–¥–æ–ª–∂–∞—è, –≤—ã —Å–æ–≥–ª–∞—à–∞–µ—Ç–µ—Å—å —Å –ø–æ–ª–æ–∂–µ–Ω–∏–µ–º –æ—Å–Ω–æ–≤–Ω—ã—Ö –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤
                    Mental Care. –≠—Ç–æ –£—Å–ª–æ–≤–∏—è –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω–∏—è —É—Å–ª—É–≥
                </BottomText>
            </div>
        </>
    );
};

export default RegistrationForm;
